<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="with=device-width, initial-scale = 1.0 ">
    <title>Inscripcion</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/estilos.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h1 class="mb-0 text-center">Formulario de Inscripción</h1>
                        <p class="text-center text-muted">Ingresa tus datos para inscribirte.</p>
                    </div>
                    <div class="card-body">
                        <form id="formularioMatricula" onsubmit="return validarFormulario()"
                            th:action="@{/matriculas/insertar}" th:object="${matricula}" th:method="POST">
                            <h2 class="mb-3">Datos del Representante</h2>
                            <div class="mb-3">
                                <label for="cedula" class="form-label">Cédula</label>
                                <input type="text" id="cedula" class="form-control" placeholder="Ingresa tu cédula"
                                    name="cedula" maxlength="10" pattern="\d{10}"
                                    th:field="${matricula.cedulaRepresentante}" required />
                                <small id="mensajeCedula" class="text-danger"></small>
                            </div>
                            <h2 class="mb-3 mt-4">Datos del Hijo</h2>
                            <div class="mb-3">
                                <label for="cedula_hijo" class="form-label">Cédula</label>
                                <input type="text" id="cedula_hijo" class="form-control" placeholder="Ingresa su cédula"
                                    name="cedula" maxlength="10" pattern="\d{10}"
                                    th:field="${matricula.cedulaEstudiante}" required />
                                <small id="mensajeCedulaHijo" class="text-danger"></small>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">Inscribirse</button>
                        </form>
                        <hr class="my-4">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function validarCedulaEcuatoriana(cedula) {
            if (cedula.length !== 10) {
                return false;
            }

            const coeficientes = [2, 1, 2, 1, 2, 1, 2, 1, 2];
            let suma = 0;

            for (let i = 0; i < coeficientes.length; i++) {
                let valor = parseInt(cedula.charAt(i)) * coeficientes[i];
                suma += (valor >= 10) ? valor - 9 : valor;
            }

            const digitoVerificador = parseInt(cedula.charAt(9));
            const resultado = (suma % 10 === 0) ? 0 : 10 - (suma % 10);

            return resultado === digitoVerificador;
        }

        document.getElementById('cedula').addEventListener('input', function (e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);

            const cedula = e.target.value;
            const mensajeCedula = document.getElementById('mensajeCedula');
            const regexCedula = /^\d{10}$/;

            if (!regexCedula.test(cedula)) {
                mensajeCedula.textContent = 'Ingrese correctamente el número de cédula (10 dígitos numéricos)';
            } else {
                if (!validarCedulaEcuatoriana(cedula)) {
                    mensajeCedula.textContent = 'Ingrese una cédula ecuatoriana válida';
                } else {
                    mensajeCedula.textContent = '';
                }
            }
        });

        document.getElementById('cedula_hijo').addEventListener('input', function (e) {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);

            const cedula_hijo = e.target.value;
            const mensajeCedulaHijo = document.getElementById('mensajeCedulaHijo');
            const regexCedulaHijo = /^\d{10}$/;

            if (!regexCedulaHijo.test(cedula_hijo)) {
                mensajeCedulaHijo.textContent = 'Ingrese correctamente el número de cédula (10 dígitos numéricos)';
            } else {
                if (!validarCedulaEcuatoriana(cedula_hijo)) {
                    mensajeCedulaHijo.textContent = 'Ingrese una cédula ecuatoriana válida de su hijo/a';
                } else {
                    mensajeCedulaHijo.textContent = '';
                }
            }
        });

        function validarFormulario() {
            const cedula = document.getElementById('cedula').value;
            const cedula_hijo = document.getElementById('cedula_hijo').value;

            const mensajeErrorCedula = "Ingrese solo números en total 10 y deben conformar un ID ecuatoriano";

            if (!/^\d{10}$/.test(cedula) || !validarCedulaEcuatoriana(cedula) || !/^\d{10}$/.test(cedula_hijo) || !validarCedulaEcuatoriana(cedula_hijo)) {
                alert(mensajeErrorCedula);
                return false;
            }

            return true
        }
    </script>

</body>
</html>