<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="with=device-width, initial-scale = 1.0 ">
    <title>Formulario Estudiante</title>
    <link rel="stylesheet" href="/static/css/estilos.css">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>
    <section class="inscripcion-header">
        <nav>
            <a href="/representantes/cuentaR"><img src="/images/logotipo.png "></a>
            <h3>LICEO CENTRAL DE CIENCIAS Y ARTE</h3>
        </nav>
    </section>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h1 class="mb-0 text-center">Formulario de Matrícula</h1>
                    </div>
                    <div class="card-body">
                        <form id="formularioMatricula" onsubmit="return validarFormulario()"
                            th:action="@{/representantes/enviado}" th:method="POST">
                            <input type="hidden" th:name="representanteId" th:value="${representanteId}">
                            <h2 class="mb-3">Datos Representante</h2>
                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre Completo</label>
                                <label for="nombre" class="form-label">Cédula</label>
                            </div>

                            <h2 class="mb-3 mt-4">Datos del Estudiante</h2>
                            <p class="text-center text-muted">Ingresa los datos de tu hijo/a</p>
                            <div class="mb-3">
                                <label for="nombre_hijo" class="form-label">Nombres</label>
                                <input type="text" id="nombre_hijo" class="form-control"
                                    onkeypress="return soloLetras(event);" placeholder="Ingresa sus nombres"
                                    name="nombre_hijo" maxlength="20" pattern="^[a-zA-Z\s]{2,254}"
                                    th:field="${estudiante.nombre}" required />
                            </div>
                            <div class="mb-3">
                                <label for="apellido_hijo" class="form-label">Apellidos</label>
                                <input type="text" id="apellido_hijo" class="form-control"
                                    onkeypress="return soloLetras(event);" placeholder="Ingresa sus apellidos"
                                    name="apellido_hijo" maxlength="20" pattern="^[a-zA-Z\s]{2,254}"
                                    th:field="${estudiante.apellido}" required />
                            </div>
                            <div class="mb-3">
                                <label for="child_birthdate" class="form-label">Fecha de Nacimiento</label>
                                <input type="date" id="child_birthdate" name="child_birthdate" min="01-01-2000"
                                    max="31-12-2018" class="form-control" th:field="${estudiante.fechaNacimiento}"
                                    required />
                                <small id="mensajeFecha" class="text-danger"></small>
                            </div>

                            <div class="mb-3">
                                <label for="cedula_hijo" class="form-label">Cédula</label>
                                <input type="text" id="cedula_hijo" class="form-control" placeholder="Ingresa su cédula"
                                    name="cedula_hijo" maxlength="10" pattern="\d{10}" th:field="${estudiante.cedula}"
                                    required />
                                <small id="mensajeCedulaHijo" class="text-danger"></small>
                            </div>
                            <div class="mb-3">
                                <label for="telefono" class="form-label">Teléfono</label>
                                <input type="tel" id="telefono" class="form-control" placeholder="Ingresa tu teléfono"
                                    maxlength="10" pattern="\d{10}" th:field="${estudiante.telefono}" required />
                            </div>

                            <div class="mb-3">
                                <button type="submit" class="btn btn-primary w-100">Ingresar Estudiante</button>
                            </div>
                        </form>

                        <script>
                            function soloLetras(event) {
                                var letra = event.keyCode;
                                // Acepta letras mayúsculas, minúsculas, tecla de retroceso, espacio y acentos
                                if ((letra >= 65 && letra <= 90) || (letra >= 97 && letra <= 122) || letra === 8 || letra === 32 ||
                                    (letra >= 192 && letra <= 255) || (letra >= 128 && letra <= 165)) {
                                    return true;
                                } else {
                                    return false;
                                }
                            }

                            function validarCedulaEcuatoriana(cedula) {
                                if (cedula.length !== 10) {
                                    return false;
                                }

                                const coeficientes = [2, 1, 2, 1, 2, 1, 2, 1, 2];
                                let suma = 0;

                                for (let i = 0; i < coeficientes.length; i++) {
                                    let valor = parseInt(cedula.charAt(i)) * coeficientes[i];
                                    suma += (valor >= 10) ? valor - 9 : valor;
                                }

                                const digitoVerificador = parseInt(cedula.charAt(9));
                                const resultado = (suma % 10 === 0) ? 0 : 10 - (suma % 10);

                                return resultado === digitoVerificador;
                            }

                            document.getElementById('cedula_hijo').addEventListener('input', function (e) {
                                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);

                                const cedula_hijo = e.target.value;
                                const mensajeCedulaHijo = document.getElementById('mensajeCedulaHijo');
                                const regexCedulaHijo = /^\d{10}$/;

                                if (!regexCedulaHijo.test(cedula_hijo)) {
                                    mensajeCedulaHijo.textContent = 'Ingrese correctamente el número de cédula (10 dígitos numéricos)';
                                } else {
                                    if (!validarCedulaEcuatoriana(cedula)) {
                                        mensajeCedulaHijo.textContent = 'Ingrese una cédula válida ecuatoriana para su hijo/a';
                                    } else {
                                        mensajeCedulaHijo.textContent = '';
                                    }
                                }
                            });


                            function validarFormulario() {
                                const cedula_hijo = document.getElementById('cedula_hijo').value;
                                const mensajeCedulaHijo = document.getElementById('mensajeCedulaHijo');
                                const regexCedula = /^\d{10}$/;

                                const birthdateInput = document.getElementById('child_birthdate');
                                const birthdate = new Date(birthdateInput.value);
                                const minDate = new Date(birthdateInput.min);
                                const maxDate = new Date(birthdateInput.max);

                                let esValido = true;

                                // validación de cédula Estudiante
                                if (!regexCedula.test(cedula_hijo) || !validarCedulaEcuatoriana(cedula_hijo)) {
                                    mensajeCedulaHijo.textContent = 'Ingrese una cédula ecuatoriana válida para su hijo/a';
                                    // alert("El campo de cédula es incorrecto \nIngrese solo números en total 10 y deben conformar un ID ecuatoriano");
                                    esValido = false;
                                } else {
                                    mensajeCedulaHijo.textContent = '';
                                }

                                // Validación de fecha de nacimiento
                                if (birthdate < minDate || birthdate > maxDate) {
                                    mensajeFecha.textContent = 'La fecha de nacimiento debe estar entre el 01/01/2000 y el 31/12/2018.';
                                    // alert('La fecha de nacimiento debe estar entre el 01/01/2000 y el 31/12/2018.');
                                    esValido = false;
                                }

                                // Mostrar mensaje de alerta general si hay errores
                                if (!esValido) {
                                    alert("Por favor, llene los datos del formulario correctamente.");
                                }

                                return esValido;
                            }

                        </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-----------------FOOTER------------------->
    <section class="footer">
        <h4> NOSOSTROS</h4>
        <p>
            Somos una institución dedicada a proporcionar una educación integral y de alta calidad.
            <br> Nuestro compromiso es con la formación de estudiantes preparados para enfrentar los retos del futuro.
        </p>
        <div class="icons">
            <i class="fa fa-facebook"></i>
            <i class="fa fa-twitter"></i>
            <i class="fa fa-instagram"></i>
            <i class="fa fa-linkedin"></i>
        </div>

    </section>
</body>

</html>