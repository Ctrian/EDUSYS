<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeLeaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>Pagos</title>
    <style>
        .d-none {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6">
                <h2 class="text-xl font-semibold mb-4">Historial</h2>
                <div class="dropdown">
                    <div th:if="${matricula.estadoPago != 'pagado'}">
                        <div class="bg-light p-4 rounded-lg" id="matriculaA">
                            <h3 class="text-lg font-semibold mb-2 cursor-pointer">Matrícula A</h3>
                            <p class="text-sm text-secondary" id="descripcionPago">Descripción: </p>

                            <p  class="text-sm text-secondary" id="fechaMatricula">Fecha: <span
                            th:text="${matricula.fecha}">Fecha de matriculación</span> </p>

                            <p class="text-sm text-secondary" id="precioOferta">Precio: <span
                                th:text="${matricula.ofertaAcademica.precio}">Precio de la oferta</span></p>

                            <p class="text-sm text-secondary" id="descripcionPago">Descripción: <span
                                    th:text="${matricula.ofertaAcademica.descripcion}">Descripción de la oferta</span>
                            </p>
                            
                        </div>
                        <div class="d-none bg-success p-4 rounded-lg" id="formularioPago">
                            <div class="d-flex justify-content-center align-items-center mb-4">
                                <img src="/images/mascota_transiciones.png" alt="Logo" class="w-16 h-16"
                                    crossorigin="anonymous">
                            </div>
                            <div class="d-flex align-items-center mb-4">
                                <p class="text-sm">Tarjeta:</p>
                                <img src="/images/tarjetas.png" alt="Credit card icon" class="w-4 h-4 ms-2" crossorigin="anonymous">
                            </div>
                            <form id="formularioPago" th:action="@{/representantes/pago}" th:method="POST">
                                <input type="hidden" name="matriculaId" th:value="${matricula.id}" />
                                <input type="hidden" name="amount" th:value="${oferta.precio}" />
                                <div class="row g-4 mb-4">
                                    <div class="col">
                                        <input type="text" placeholder="Número de tarjeta" class="form-control"
                                            required />
                                    </div>
                                    <div class="col">
                                        <input type="text" placeholder="MM/YY" class="form-control" required />
                                    </div>
                                    <div class="col">
                                        <input type="text" placeholder="CVV" class="form-control" required />
                                    </div>
                                </div>
                                <div class="row g-4 mb-4">
                                    <div class="col-12">
                                        <input type="text" placeholder="Nombres y Apellidos" class="form-control"
                                            required />
                                    </div>
                                    <div class="col-6">
                                        <input type="text" placeholder="Cédula o Pasaporte" class="form-control"
                                            required />
                                    </div>
                                    <div class="col-6">
                                        <input type="text" placeholder="Teléfono" class="form-control" required />
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-warning text-white me-2"
                                    id="pagarButton">Pagar</button>
                                <button type="button" class="btn btn-light" onclick="cancelarPago()">Cancelar</button>
                                <p class="text-xs mt-2">Acepto términos y condiciones</p>
                            </form>
                        </div>
                    </div>
                    <div th:if="${matricula.estadoPago == 'pagado'}">
                        <div class="bg-light p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-2">Matrícula A</h3>
                            <p class="text-sm text-secondary" th:text="'Descripción: ' + ${oferta.descripcion}">
                                Descripción de la oferta</p>
                            <p class="text-sm text-secondary" th:text="'Precio: ' + ${oferta.precio}">Precio de la
                                oferta</p>
                            <p class="text-sm text-secondary text-success">Pago realizado</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <h2 class="text-xl font-semibold mb-4">Estado</h2>
                <div class="bg-light p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-2">Descripción del Pago</h3>
                    <p class="text-sm text-secondary" th:text="${matricula.estadoPago}">Pago pendiente, pagado</p>
                    <ul>
                        <li><span class="font-semibold">Fecha: </span><span th:text="${matricula.fecha}">Fecha de la
                                matrícula</span></li>
                        <li><span class="font-semibold">Monto: </span><span
                                th:text="${matricula.ofertaAcademica.precio}">Precio
                                de la matrícula</span></li>
                        <li><span class="font-semibold">Descripción: </span><span
                                th:text="${matricula.ofertaAcademica.descripcion}">Descripción de la matrícula</span>
                        </li>
                    </ul>
                    <div th:if="${matricula.estadoPago == 'pagado'}" class="mt-4">
                        <a th:href="@{/representantes/vistaFactura(matriculaId=${matricula.id})}" target="_blank"
                            class="btn btn-primary mt-2">Ver Factura</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const matriculaA = document.getElementById('matriculaA');
        const formularioPago = document.getElementById('formularioPago');
        const pagarButton = document.getElementById('pagarButton');

        if (matriculaA) {
            matriculaA.addEventListener('click', () => {
                formularioPago.classList.toggle('d-none');
            });
        }

        pagarButton.addEventListener('click', () => {
            // Simula el proceso de pago y cambia el estado de la matrícula
            formularioPago.classList.add('d-none');
            matriculaA.classList.add('d-none'); // Ocultar la sección de matrícula después del pago
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</body>

</html>